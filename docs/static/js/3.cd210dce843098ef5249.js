webpackJsonp([3],{"8viA":function(t,s){},AK3k:function(t,s,e){"use strict";var i=e("NqH4");String,String,String;function o(t,s){var e={};for(var i in s){var o=s[i],n=[];for(var a in o)n.push({type:t,name:i,key:a,img:o[a].img});n.length>0&&(e[i]={type:t,name:i,list:n,album:n[0].img})}return e}var n={props:{type:String,scene:String,to:String},data:function(){return{currType:"emoji",currAlbum:"emoji"}},computed:{emoji:function(){return o("emoji",i.a.emojiList)},pinup:function(){return o("pinup",i.a.pinupList)},currEmoji:function(){return"emoji"===this.currType?this.emoji[this.currAlbum]:"pinup"===this.currType?this.pinup[this.currAlbum]:[]}},methods:{selectAlbum:function(t){this.currType=t.type,this.currAlbum=t.name},selectEmoji:function(t){"emoji"===this.currType?this.$emit("add-emoji",t.key):"pinup"===this.currType&&("session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}),this.$emit("hide-emoji"))}}},a={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"m-chat-emoji"},[e("div",{staticClass:"emoji-content"},[e("div",{staticClass:"cnt"},t._l(t.currEmoji.list,function(s){return e("span",{staticClass:"emoji-item",class:{"pinup-item":"pinup"===s.type},on:{click:function(e){e.stopPropagation(),t.selectEmoji(s)}}},[e("img",{attrs:{src:s.img}})])}),0)]),t._v(" "),e("div",{staticClass:"emoji-channel"},[t._l(t.emoji,function(s){return e("span",{staticClass:"emoji-album",class:{active:s.name==t.currAlbum},on:{click:function(e){e.stopPropagation(),t.selectAlbum(s)}}},[e("img",{attrs:{src:s.album}})])}),t._l(t.pinup,function(s){return"session"===t.type?e("span",{staticClass:"emoji-album",class:{active:s.name==t.currAlbum},on:{click:function(e){e.stopPropagation(),t.selectAlbum(s)}}},[e("img",{attrs:{src:s.album}})]):t._e()})],2)])},staticRenderFns:[]};var r=e("VU/8")(n,a,!1,function(t){e("WftJ")},null,null).exports,c=(e("0xDb"),e("moKT")),h=e("4NmY"),m=(String,String,String,Boolean,Boolean,String,Boolean,{components:{ChatEmoji:r},updated:function(){var t=this;window.document.body.addEventListener("click",function(){t.isEmojiShown=!1})},props:{type:String,scene:String,to:String,isRobot:{type:Boolean,default:function(){return!1}},invalid:{type:Boolean,default:!1},invalidHint:{type:String,default:"您无权限发送消息"},advancedTeam:{type:Boolean,default:!1}},watch:{continueRobotAccid:function(t,s){t&&this.robotInfos[t]&&(this.msgToSent="@"+this.robotInfos[t].nick+" "),this.$store.dispatch("continueRobotMsg","")},msgToSent:function(t,s){if(!this.isRobot){var e=this.msgToSent.indexOf("@");e>=0&&e===this.msgToSent.length-1?this.robotslist&&this.robotslist.length>0&&(this.isRobotListShown=!0):!0===this.isRobotListShown&&(this.isRobotListShown=!1)}}},data:function(){return{isEmojiShown:!1,isRobotListShown:!1,msgToSent:"",icon1:c.a.resourceUrl+"/im/chat-editor-1.png",icon2:c.a.resourceUrl+"/im/chat-editor-2.png",icon3:c.a.resourceUrl+"/im/chat-editor-3.png"}},computed:{continueRobotAccid:function(){return this.$store.state.continueRobotAccid},robotslist:function(){return this.$store.state.robotslist},robotInfos:function(){return this.$store.state.robotInfos},robotInfosByNick:function(){return this.$store.state.robotInfosByNick}},methods:{sendTextMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else if(/^\s*$/.test(this.msgToSent))this.$vux.alert.show({title:"请不要发送空消息"});else if(this.msgToSent.length>800)this.$vux.alert.show({title:"请不要超过800个字"});else{if(this.msgToSent=this.msgToSent.trim(),"session"===this.type)if(this.isRobot)this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:this.to,content:this.msgToSent,body:this.msgToSent});else{var t="",s="",e=this.msgToSent.match(/@[^\s@$]+/g);if(e)for(var i=0;i<e.length;i++){var o=e[i].replace("@","");if(this.robotInfosByNick[o]){t=this.robotInfosByNick[o].account,s=(this.msgToSent+"").replace(e[i],"").trim();break}}t?s?this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:t,content:s,body:this.msgToSent}):this.$store.dispatch("sendRobotMsg",{type:"welcome",scene:this.scene,to:this.to,robotAccid:t,body:this.msgToSent}):this.$store.dispatch("sendMsg",{type:"text",scene:this.scene,to:this.to,text:this.msgToSent})}else if("chatroom"===this.type){var n="",a="",r=this.msgToSent.match(/@[^\s@$]+/g);if(r)for(var c=0;c<r.length;c++){var h=r[c].replace("@","");if(this.robotInfosByNick[h]){n=this.robotInfosByNick[h].account,a=(this.msgToSent+"").replace(r[c],"").trim();break}}n?a?this.$store.dispatch("sendChatroomRobotMsg",{type:"text",robotAccid:n,content:a,body:this.msgToSent}):this.$store.dispatch("sendChatroomRobotMsg",{type:"welcome",robotAccid:n,body:this.msgToSent}):this.$store.dispatch("sendChatroomMsg",{type:"text",text:this.msgToSent})}this.msgToSent=""}},sendPlayMsg:function(){this.invalid?this.$toast(this.invalidHint):"session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}})},sendFileMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else{var t=this.$refs.fileToSent;t.value&&("session"===this.type?this.$store.dispatch("sendFileMsg",{scene:this.scene,to:this.to,fileInput:t}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomFileMsg",{fileInput:t}))}},showEmoji:function(){this.isEmojiShown=!0},hideEmoji:function(){this.isEmojiShown=!1},addEmoji:function(t){this.msgToSent+=t,this.hideEmoji()},chooseRobot:function(t){if(t&&t.account){var s=this.msgToSent.length;0!==s&&"@"===this.msgToSent[s-1]||(this.msgToSent+="@"+t.nick+" "),this.msgToSent+=t.nick+" "}},hideRobotList:function(){this.isRobotListShown=!1},onInputFocus:function(t){setTimeout(function(){t.target.scrollIntoView(),h.a.scrollChatListDown()},200)},turnToMsgReceipt:function(){this.invalid?this.$toast(this.invalidHint):location="#/teamSendMsgReceipt/"+this.to}}}),u={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"m-chat-editor",on:{click:t.hideRobotList}},[e("chat-emoji",{directives:[{name:"show",rawName:"v-show",value:t.isEmojiShown,expression:"isEmojiShown"}],attrs:{type:t.type,scene:t.scene,to:t.to},on:{"add-emoji":t.addEmoji,"hide-emoji":t.hideEmoji}}),t._v(" "),e("group",{directives:[{name:"show",rawName:"v-show",value:t.isRobotListShown,expression:"isRobotListShown"}],staticClass:"m-chat-emoji m-chat-robot"},t._l(t.robotslist,function(s){return e("cell",{key:s.account,attrs:{title:s.nick},nativeOn:{click:function(e){t.chooseRobot(s)}}},[e("img",{staticClass:"icon u-circle",attrs:{slot:"icon",width:"20",height:"20",src:s.avatar},slot:"icon"})])}),1),t._v(" "),e("div",{staticClass:"m-chat-editor-main",class:{robot:t.isRobot}},[e("span",{staticClass:"u-editor-input"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msgToSent,expression:"msgToSent"}],domProps:{value:t.msgToSent},on:{focus:t.onInputFocus,input:function(s){s.target.composing||(t.msgToSent=s.target.value)}}})]),t._v(" "),e("span",{staticClass:"u-editor-icons"},[t.isRobot?t._e():e("span",{staticClass:"u-editor-icon",on:{click:function(s){return s.stopPropagation(),t.showEmoji(s)}}},[e("i",{staticClass:"u-icon-img"},[e("img",{attrs:{src:t.icon1}})])]),t._v(" "),t.isRobot?t._e():e("span",{staticClass:"u-editor-icon",on:{change:t.sendFileMsg}},[e("i",{staticClass:"u-icon-img"},[e("img",{attrs:{src:t.icon2}})]),t._v(" "),e("input",{ref:"fileToSent",attrs:{type:"file"}})]),t._v(" "),t.isRobot||t.advancedTeam?t._e():e("span",{staticClass:"u-editor-icon",on:{click:function(s){return s.stopPropagation(),t.sendPlayMsg(s)}}},[e("i",{staticClass:"u-icon-img"},[e("img",{attrs:{src:t.icon3}})])]),t._v(" "),t.advancedTeam?e("span",{staticClass:"u-editor-send u-editor-receipt",on:{click:t.turnToMsgReceipt}},[t._v("回执")]):t._e(),t._v(" "),e("span",{staticClass:"u-editor-send",on:{click:t.sendTextMsg}},[t._v("发 送")])])])],1)},staticRenderFns:[]};var l=e("VU/8")(m,u,!1,function(t){e("DSXX")},"data-v-6724720a",null);s.a=l.exports},DSXX:function(t,s){},WftJ:function(t,s){},aYPZ:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("AK3k"),o=e("ClMD"),n=e("0xDb"),a=e("4NmY"),r=(i.a,o.a,{components:{ChatEditor:i.a,ChatList:o.a},mounted:function(){var t=this;if(this.$store.dispatch("showLoading"),this.$store.dispatch("setCurrSession",this.sessionId),a.a.scrollChatListDown(),setTimeout(function(){t.$store.dispatch("hideLoading")},1e3),"team"===this.scene){var s=this.$store.state.teamMembers[this.to];(void 0===s||s.length<this.teamInfo.memberNum)&&this.$store.dispatch("getTeamMembers",this.to)}},updated:function(){a.a.scrollChatListDown()},destroyed:function(){this.$store.dispatch("resetCurrSession")},data:function(){return{leftBtnOptions:{backText:" ",preventGoBack:!0}}},computed:{sessionId:function(){var t=this.$route.params.sessionId;return t},sessionName:function(){var t=this.sessionId,s=null;if(/^p2p-/.test(t)){if((s=t.replace(/^p2p-/,""))===this.$store.state.userUID)return"我的手机";if(this.isRobot)return this.robotInfos[s].nick;var e=this.userInfos[s]||{};return n.a.getFriendAlias(e)}if(/^team-/.test(t)){if(this.teamInfo){var i=this.$store.state.teamMembers&&this.$store.state.teamMembers[this.teamInfo.teamId],o=i&&i.length;return this.teamInfo.name+(o?"("+o+")":"")}return"群"}},scene:function(){return n.a.parseSession(this.sessionId).scene},to:function(){return n.a.parseSession(this.sessionId).to},isRobot:function(){var t=this.sessionId,s=null;return!(!/^p2p-/.test(t)||(s=t.replace(/^p2p-/,""),!this.robotInfos[s]))},myInfo:function(){return this.$store.state.myInfo},userInfos:function(){return this.$store.state.userInfos},robotInfos:function(){return this.$store.state.robotInfos},msglist:function(){return this.$store.state.currSessionMsgs},teamInfo:function(){if("team"===this.scene){var t=this.sessionId.replace("team-","");return this.$store.state.teamlist.find(function(s){return s.teamId===t})}},muteInTeam:function(){var t=this;if("team"!==this.scene)return!1;var s=this.$store.state.teamMembers,e=s&&s[this.teamInfo.teamId],i=e&&e.find(function(s){return s.account===t.$store.state.userUID});return i&&i.mute||!1},teamInvalid:function(){return"team"===this.scene&&!(this.teamInfo&&this.teamInfo.validToCurrentUser)},sendInvalidHint:function(){return"team"===this.scene&&this.teamInvalid?"您已不在该"+(this.teamInfo&&"normal"===this.teamInfo.type?"讨论组":"群")+"，不能发送消息":this.muteInTeam?"您已被禁言":"无权限发送消息"}},methods:{onClickBack:function(){window.history.go(-1)},msgsLoaded:function(){a.a.scrollChatListDown()},enterNameCard:function(){if(/^p2p-/.test(this.sessionId)){var t=this.sessionId.replace(/^p2p-/,"");if(t===this.$store.state.userUID)return void(location.href="#/general");location.href="#/namecard/"+t}},onTeamManageClick:function(){this.teamInfo&&this.teamInfo.validToCurrentUser?location.href="#/teammanage/"+this.teamInfo.teamId:this.$toast("您已退出该群")},onHistoryClick:function(){"team"!==this.scene||this.teamInfo&&this.teamInfo.validToCurrentUser?location.href="#/chathistory/"+this.sessionId:this.$toast("您已退出该群")}}}),c={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"g-inherit m-article"},[e("x-header",{staticClass:"m-tab",attrs:{"left-options":t.leftBtnOptions},on:{"on-click-back":t.onClickBack}},[e("h1",{staticClass:"m-tab-top",on:{click:t.enterNameCard}},[t._v(t._s(t.sessionName))]),t._v(" "),e("a",{attrs:{slot:"left"},slot:"left"}),t._v(" "),e("div",{staticClass:"m-tab-right",attrs:{slot:"right"},slot:"right"},[e("span",{staticClass:"icon-history",on:{click:t.onHistoryClick}}),t._v(" "),"team"===t.scene?e("span",{staticClass:"icon-team",on:{click:t.onTeamManageClick}}):t._e()])]),t._v(" "),e("div",{staticClass:"m-chat-main"},["team"===t.scene&&t.teamInvalid?e("div",{staticClass:"invalidHint"},[t._v("\n      "+t._s("您已退出该"+(t.teamInfo&&"normal"===t.teamInfo.type?"讨论组":"群"))+"\n    ")]):t._e(),t._v(" "),e("chat-list",{attrs:{type:"session",msglist:t.msglist,userInfos:t.userInfos,myInfo:t.myInfo,isRobot:t.isRobot},on:{"msgs-loaded":t.msgsLoaded}}),t._v(" "),e("chat-editor",{attrs:{type:"session",scene:t.scene,to:t.to,isRobot:t.isRobot,invalid:t.teamInvalid||t.muteInTeam,invalidHint:t.sendInvalidHint,advancedTeam:t.teamInfo&&"advanced"===t.teamInfo.type}})],1)],1)},staticRenderFns:[]};var h=e("VU/8")(r,c,!1,function(t){e("twOK"),e("8viA")},"data-v-4e4c8f0c",null);s.default=h.exports},twOK:function(t,s){}});
//# sourceMappingURL=3.cd210dce843098ef5249.js.map