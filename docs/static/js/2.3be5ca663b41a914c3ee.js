webpackJsonp([2],{"8hv0":function(t,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=s("AK3k"),e=s("ClMD"),n=s("0xDb"),a=s("4NmY"),c=(i.a,e.a,{components:{ChatEditor:i.a,ChatList:e.a},mounted:function(){a.a.scrollChatListDown()},updated:function(){a.a.scrollChatListDown()},data:function(){return{}},computed:{chatroomId:function(){var t=this.$route.params.chatroomId;return t},msglist:function(){return this.$store.state.currChatroomMsgs}},methods:{msgsLoaded:function(){a.a.scrollChatListDown()}}}),r={render:function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"m-chat-main p-room-chat-list"},[o("chat-list",{attrs:{type:"chatroom",chatroomId:this.chatroomId,msglist:this.msglist},on:{"msgs-loaded":this.msgsLoaded}}),this._v(" "),o("chat-editor",{attrs:{type:"chatroom",chatroomId:this.chatroomId}})],1)},staticRenderFns:[]};var h=s("VU/8")(c,r,!1,function(t){s("oK17")},"data-v-173c4812",null).exports,m=s("moKT"),u={mounted:function(){this.$store.dispatch("getChatroomInfo")},computed:{chatroomInfo:function(){var t=this.$store.state.currChatroomInfo;return t.showTime=n.a.formatDate(t.createTime),t},chatroomNotice:function(){return this.chatroomInfo.announcement||"暂无公告"},chatroomActor:function(){if(this.chatroomInfo){var t=this.chatroomInfo.actor||{};return t.avatar=t.avatar||m.a.defaultUserIcon,t}return{}}}},l={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",{staticClass:"p-room-chat-actor"},[s("div",{staticClass:"actor-info"},[s("span",{staticClass:"actor-avatar"},[s("img",{attrs:{src:t.chatroomActor.avatar}})]),t._v(" "),s("span",{staticClass:"actor-status"},[s("h3",[t._v("主播： "+t._s(t.chatroomActor.nick||t.chatroomActor.account)+" ")]),t._v(" "),s("p",[s("span",[t._v("\n          在线："+t._s(t.chatroomInfo.onlineMemberNum)+"\n        ")])])])]),t._v(" "),s("div",{staticClass:"actor-notice"},[s("h3",[t._v("公告：")]),t._v(" "),s("p",[t._v("\n      "+t._s(t.chatroomNotice)+"\n    ")])])])},staticRenderFns:[]};var d=s("VU/8")(u,l,!1,function(t){s("Y0mS")},null,null).exports,p={mounted:function(){this.$store.dispatch("getChatroomMembers")},destroyed:function(){this.$store.dispatch("clearChatroomMembers")},computed:{chatroomMembers:function(){return this.$store.state.currChatroomMembers.map(function(t){switch(t.avatar?/\?imageView/.test(t.avatar)||(t.avatar+="?imageView&thumbnail=40x40&quality=85"):t.avatar=m.a.defaultUserIcon,t.type){case"owner":t.showType="群主";break;case"manager":t.showType="管理员";break;case"common":case"normal":t.showType="普通成员";break;case"restricted":t.showType="受限制";break;case"guest":t.showType="游客"}return t})}}},f={render:function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"p-room-chat-online"},[o("group",{staticClass:"u-list"},this._l(this.chatroomMembers,function(t,s){return o("cell",{key:t.account,staticClass:"u-list-item",attrs:{title:t.nick||t.account,"inline-desc":t.showType}},[o("img",{staticClass:"icon",attrs:{slot:"icon",width:"24",src:t.avatar},slot:"icon"})])}),1)],1)},staticRenderFns:[]};var g=s("VU/8")(p,f,!1,function(t){s("sOBi")},null,null).exports,v={beforeMount:function(){this.$store.state.isRefresh?location.href="#/room":this.$store.dispatch("connect",{type:"chatroom",chatroomId:this.chatroomId})},destroyed:function(){this.$store.dispatch("resetChatroomSDK",this.chatroomId)},components:{RoomChatList:h,RoomChatMember:g,RoomChatActor:d},data:function(){return{roomType:1}},computed:{chatroomId:function(){var t=this.$route.params.chatroomId;return t},chatroomInfo:function(){return this.$store.state.chatroomInfos[this.chatroomId]||{}}},methods:{changeRoomType:function(t){this.roomType=t},enterHall:function(){location.href="#/room"}}},b={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",{staticClass:"g-inherit m-room p-room-chat"},[s("div",{staticClass:"m-room-album"},[s("div",{staticClass:"img-wraper"},[s("img",{staticClass:"room-img",attrs:{src:t.chatroomInfo.album}})]),t._v(" "),s("span",{staticClass:"left-arrow",on:{click:t.enterHall}})]),t._v(" "),s("div",{staticClass:"m-room-tabs"},[s("span",{staticClass:"u-tab",class:{active:1===t.roomType},on:{click:function(o){t.changeRoomType(1)}}},[t._v("\n      直播互动\n    ")]),s("span",{staticClass:"u-tab",class:{active:2===t.roomType},on:{click:function(o){t.changeRoomType(2)}}},[t._v("\n      主播\n    ")]),s("span",{staticClass:"u-tab",class:{active:3===t.roomType},on:{click:function(o){t.changeRoomType(3)}}},[t._v("\n      在线成员\n    ")])]),t._v(" "),s("div",{staticClass:"m-room-container"},[s("div",{staticClass:"room-cnt"},[1===t.roomType?s("room-chat-list"):t._e(),t._v(" "),2===t.roomType?s("room-chat-actor"):t._e(),t._v(" "),3===t.roomType?s("room-chat-member"):t._e()],1)])])},staticRenderFns:[]};var y=s("VU/8")(v,b,!1,function(t){s("pcY/")},null,null);o.default=y.exports},AK3k:function(t,o,s){"use strict";var i=s("NqH4");String,String,String;function e(t,o){var s={};for(var i in o){var e=o[i],n=[];for(var a in e)n.push({type:t,name:i,key:a,img:e[a].img});n.length>0&&(s[i]={type:t,name:i,list:n,album:n[0].img})}return s}var n={props:{type:String,scene:String,to:String},data:function(){return{currType:"emoji",currAlbum:"emoji"}},computed:{emoji:function(){return e("emoji",i.a.emojiList)},pinup:function(){return e("pinup",i.a.pinupList)},currEmoji:function(){return"emoji"===this.currType?this.emoji[this.currAlbum]:"pinup"===this.currType?this.pinup[this.currAlbum]:[]}},methods:{selectAlbum:function(t){this.currType=t.type,this.currAlbum=t.name},selectEmoji:function(t){"emoji"===this.currType?this.$emit("add-emoji",t.key):"pinup"===this.currType&&("session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}),this.$emit("hide-emoji"))}}},a={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",{staticClass:"m-chat-emoji"},[s("div",{staticClass:"emoji-content"},[s("div",{staticClass:"cnt"},t._l(t.currEmoji.list,function(o){return s("span",{staticClass:"emoji-item",class:{"pinup-item":"pinup"===o.type},on:{click:function(s){s.stopPropagation(),t.selectEmoji(o)}}},[s("img",{attrs:{src:o.img}})])}),0)]),t._v(" "),s("div",{staticClass:"emoji-channel"},[t._l(t.emoji,function(o){return s("span",{staticClass:"emoji-album",class:{active:o.name==t.currAlbum},on:{click:function(s){s.stopPropagation(),t.selectAlbum(o)}}},[s("img",{attrs:{src:o.album}})])}),t._l(t.pinup,function(o){return"session"===t.type?s("span",{staticClass:"emoji-album",class:{active:o.name==t.currAlbum},on:{click:function(s){s.stopPropagation(),t.selectAlbum(o)}}},[s("img",{attrs:{src:o.album}})]):t._e()})],2)])},staticRenderFns:[]};var c=s("VU/8")(n,a,!1,function(t){s("WftJ")},null,null).exports,r=(s("0xDb"),s("moKT")),h=s("4NmY"),m=(String,String,String,Boolean,Boolean,String,Boolean,{components:{ChatEmoji:c},updated:function(){var t=this;window.document.body.addEventListener("click",function(){t.isEmojiShown=!1})},props:{type:String,scene:String,to:String,isRobot:{type:Boolean,default:function(){return!1}},invalid:{type:Boolean,default:!1},invalidHint:{type:String,default:"您无权限发送消息"},advancedTeam:{type:Boolean,default:!1}},watch:{continueRobotAccid:function(t,o){t&&this.robotInfos[t]&&(this.msgToSent="@"+this.robotInfos[t].nick+" "),this.$store.dispatch("continueRobotMsg","")},msgToSent:function(t,o){if(!this.isRobot){var s=this.msgToSent.indexOf("@");s>=0&&s===this.msgToSent.length-1?this.robotslist&&this.robotslist.length>0&&(this.isRobotListShown=!0):!0===this.isRobotListShown&&(this.isRobotListShown=!1)}}},data:function(){return{isEmojiShown:!1,isRobotListShown:!1,msgToSent:"",icon1:r.a.resourceUrl+"/im/chat-editor-1.png",icon2:r.a.resourceUrl+"/im/chat-editor-2.png",icon3:r.a.resourceUrl+"/im/chat-editor-3.png"}},computed:{continueRobotAccid:function(){return this.$store.state.continueRobotAccid},robotslist:function(){return this.$store.state.robotslist},robotInfos:function(){return this.$store.state.robotInfos},robotInfosByNick:function(){return this.$store.state.robotInfosByNick}},methods:{sendTextMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else if(/^\s*$/.test(this.msgToSent))this.$vux.alert.show({title:"请不要发送空消息"});else if(this.msgToSent.length>800)this.$vux.alert.show({title:"请不要超过800个字"});else{if(this.msgToSent=this.msgToSent.trim(),"session"===this.type)if(this.isRobot)this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:this.to,content:this.msgToSent,body:this.msgToSent});else{var t="",o="",s=this.msgToSent.match(/@[^\s@$]+/g);if(s)for(var i=0;i<s.length;i++){var e=s[i].replace("@","");if(this.robotInfosByNick[e]){t=this.robotInfosByNick[e].account,o=(this.msgToSent+"").replace(s[i],"").trim();break}}t?o?this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:t,content:o,body:this.msgToSent}):this.$store.dispatch("sendRobotMsg",{type:"welcome",scene:this.scene,to:this.to,robotAccid:t,body:this.msgToSent}):this.$store.dispatch("sendMsg",{type:"text",scene:this.scene,to:this.to,text:this.msgToSent})}else if("chatroom"===this.type){var n="",a="",c=this.msgToSent.match(/@[^\s@$]+/g);if(c)for(var r=0;r<c.length;r++){var h=c[r].replace("@","");if(this.robotInfosByNick[h]){n=this.robotInfosByNick[h].account,a=(this.msgToSent+"").replace(c[r],"").trim();break}}n?a?this.$store.dispatch("sendChatroomRobotMsg",{type:"text",robotAccid:n,content:a,body:this.msgToSent}):this.$store.dispatch("sendChatroomRobotMsg",{type:"welcome",robotAccid:n,body:this.msgToSent}):this.$store.dispatch("sendChatroomMsg",{type:"text",text:this.msgToSent})}this.msgToSent=""}},sendPlayMsg:function(){this.invalid?this.$toast(this.invalidHint):"session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}})},sendFileMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else{var t=this.$refs.fileToSent;t.value&&("session"===this.type?this.$store.dispatch("sendFileMsg",{scene:this.scene,to:this.to,fileInput:t}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomFileMsg",{fileInput:t}))}},showEmoji:function(){this.isEmojiShown=!0},hideEmoji:function(){this.isEmojiShown=!1},addEmoji:function(t){this.msgToSent+=t,this.hideEmoji()},chooseRobot:function(t){if(t&&t.account){var o=this.msgToSent.length;0!==o&&"@"===this.msgToSent[o-1]||(this.msgToSent+="@"+t.nick+" "),this.msgToSent+=t.nick+" "}},hideRobotList:function(){this.isRobotListShown=!1},onInputFocus:function(t){setTimeout(function(){t.target.scrollIntoView(),h.a.scrollChatListDown()},200)},turnToMsgReceipt:function(){this.invalid?this.$toast(this.invalidHint):location="#/teamSendMsgReceipt/"+this.to}}}),u={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",{staticClass:"m-chat-editor",on:{click:t.hideRobotList}},[s("chat-emoji",{directives:[{name:"show",rawName:"v-show",value:t.isEmojiShown,expression:"isEmojiShown"}],attrs:{type:t.type,scene:t.scene,to:t.to},on:{"add-emoji":t.addEmoji,"hide-emoji":t.hideEmoji}}),t._v(" "),s("group",{directives:[{name:"show",rawName:"v-show",value:t.isRobotListShown,expression:"isRobotListShown"}],staticClass:"m-chat-emoji m-chat-robot"},t._l(t.robotslist,function(o){return s("cell",{key:o.account,attrs:{title:o.nick},nativeOn:{click:function(s){t.chooseRobot(o)}}},[s("img",{staticClass:"icon u-circle",attrs:{slot:"icon",width:"20",height:"20",src:o.avatar},slot:"icon"})])}),1),t._v(" "),s("div",{staticClass:"m-chat-editor-main",class:{robot:t.isRobot}},[s("span",{staticClass:"u-editor-input"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msgToSent,expression:"msgToSent"}],domProps:{value:t.msgToSent},on:{focus:t.onInputFocus,input:function(o){o.target.composing||(t.msgToSent=o.target.value)}}})]),t._v(" "),s("span",{staticClass:"u-editor-icons"},[t.isRobot?t._e():s("span",{staticClass:"u-editor-icon",on:{click:function(o){return o.stopPropagation(),t.showEmoji(o)}}},[s("i",{staticClass:"u-icon-img"},[s("img",{attrs:{src:t.icon1}})])]),t._v(" "),t.isRobot?t._e():s("span",{staticClass:"u-editor-icon",on:{change:t.sendFileMsg}},[s("i",{staticClass:"u-icon-img"},[s("img",{attrs:{src:t.icon2}})]),t._v(" "),s("input",{ref:"fileToSent",attrs:{type:"file"}})]),t._v(" "),t.isRobot||t.advancedTeam?t._e():s("span",{staticClass:"u-editor-icon",on:{click:function(o){return o.stopPropagation(),t.sendPlayMsg(o)}}},[s("i",{staticClass:"u-icon-img"},[s("img",{attrs:{src:t.icon3}})])]),t._v(" "),t.advancedTeam?s("span",{staticClass:"u-editor-send u-editor-receipt",on:{click:t.turnToMsgReceipt}},[t._v("回执")]):t._e(),t._v(" "),s("span",{staticClass:"u-editor-send",on:{click:t.sendTextMsg}},[t._v("发 送")])])])],1)},staticRenderFns:[]};var l=s("VU/8")(m,u,!1,function(t){s("DSXX")},"data-v-6724720a",null);o.a=l.exports},DSXX:function(t,o){},WftJ:function(t,o){},Y0mS:function(t,o){},oK17:function(t,o){},"pcY/":function(t,o){},sOBi:function(t,o){}});
//# sourceMappingURL=2.3be5ca663b41a914c3ee.js.map